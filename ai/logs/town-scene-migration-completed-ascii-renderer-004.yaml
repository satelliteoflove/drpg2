node_id: town-scene-migration
checklist:
  unit_tests: false
  integration_tests: true
  e2e_tests: true
outcome: |
  Successfully completed ASCII integration for TownScene with full feature flag support.
  - TownASCIIState fully renders town menu with ASCII art
  - Menu navigation works correctly with arrow keys
  - Scene transitions work (to Shop and back to Dungeon)
  - Feature flag toggles between ASCII and canvas rendering dynamically
  - Bidirectional synchronization between TownScene and TownASCIIState
manual_test_instructions: |
  1. Start the dev server with 'npm run dev'
  2. Open http://localhost:8080 in browser
  3. Start a new game (press Enter on main menu)
  4. Press ESC to navigate to town
  5. Enable ASCII mode: window.FeatureFlags.enable('ascii_town_scene')
  6. Verify ASCII rendering with town art and menu
  7. Use arrow keys to navigate menu options
  8. Press Enter on "Boltac's Trading Post" to go to shop
  9. Press ESC to return to town
  10. Press ESC again to return to dungeon
  11. Disable ASCII: window.FeatureFlags.disable('ascii_town_scene')
  12. Verify canvas rendering returns
surprises_or_notes: |
  - TownASCIIState was already created but not fully integrated
  - Menu options needed alignment between TownScene and TownASCIIState
  - Feature flag system works well for gradual rollout
  - ASCII art adds nice visual appeal to the town scene
suggested_follow_ups:
  - Complete ShopScene ASCII integration (ASCII state exists but not integrated)
  - Complete CombatScene ASCII integration (partially done)
  - Create InventoryScene ASCII state and integration
  - Add more interactive elements to town ASCII (animated characters, etc.)
reimplementation_prompt: |
  Complete the ASCII integration for TownScene in a Wizardry-like game.
  
  Requirements:
  - Use existing TownASCIIState class that extends BaseASCIIScene
  - Implement bidirectional sync between TownScene and TownASCIIState
  - Support feature flag toggling with FeatureFlags system
  - Menu should have 4 options: Trading Post, Temple, Inn, Return to Dungeon
  - ASCII art should show town buildings
  - Handle keyboard navigation (arrows, Enter, ESC)
  - Ensure getSelectedOption() method exists in TownASCIIState
  - Update handleInput in TownScene to delegate to ASCII state when enabled
  - Scene transitions must work correctly (to Shop and Dungeon)